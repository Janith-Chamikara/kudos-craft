pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                echo 'Getting code...'
                checkout scm
            }
        }

        stage('Parallel Builds') {
            parallel {
                // --- Job 1: Backend ---
                // stage('Backend Build') {
                //     environment {
                //         DATABASE_URL = 'file:./dev.db'
                //         NODE_ENV = 'development'
                //     }

                //     steps {
                //         dir('backend') {
                //             echo 'Installing backend dependencies'
                //             sh 'npm install --network-timeout=1000000'

                //             echo 'Running Prisma migrations'
                //             sh 'npx prisma migrate deploy'

                //             echo 'Generate prisam client'
                //             sh 'npx prisma generate'

                //             echo 'Seed the database'
                //             sh 'npm run seed'
                            
                //             echo 'Building backend...'
                //             sh 'npm run build'
                //         }
                //     }
                // }

                // --- Job 2: Frontend ---
                stage('Frontend Build') {
                    steps {
                        dir('frontend') {
                            echo 'Installing frontend dependencies...'
                            sh 'npm install --legacy-peer-deps --timeout=600000 --fetch-timeout=600000'
                            
                            echo 'Building frontend...'
                            sh 'npm run build'
                        }
                    }
                }
            }
        }
    }
}